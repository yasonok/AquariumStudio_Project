<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“ç®¡ç† - Aquarium Studio</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: #f5f5f5; min-height: 100vh; }
        
        /* ç™»å…¥é é¢ */
        .login-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea, #764ba2); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .login-box { background: white; border-radius: 20px; padding: 40px 30px; width: 100%; max-width: 360px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.2); }
        .login-box .icon { font-size: 3.5rem; margin-bottom: 15px; }
        .login-box h1 { font-size: 1.4rem; margin-bottom: 8px; color: #333; }
        .login-box p { color: #888; font-size: 0.9rem; margin-bottom: 25px; }
        .login-box input { width: 100%; padding: 16px; border: 2px solid #eee; border-radius: 12px; font-size: 1.1rem; text-align: center; margin-bottom: 15px; }
        .login-box input:focus { outline: none; border-color: #667eea; }
        .login-box button { width: 100%; padding: 16px; background: #667eea; color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer; }
        .login-box .error { color: #ff6b6b; font-size: 0.85rem; margin-top: 10px; display: none; }
        .login-box .hint { color: #888; font-size: 0.8rem; margin-top: 15px; }
        
        /* ç®¡ç†å¾Œå° */
        .admin-content { display: none; }
        .admin-content.active { display: block; }
        
        .header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .header h1 { font-size: 1.2rem; }
        .header-btns { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        .header-btns button, .header-btns a { background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; text-decoration: none; }
        .header-btns button:hover { background: rgba(255,255,255,0.3); }
        .header-btns .btn-logout { background: rgba(255,107,107,0.8); }
        
        .stats { display: flex; gap: 10px; padding: 15px; background: white; overflow-x: auto; }
        .stat { min-width: 100px; text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px; flex: 1; }
        .stat .num { font-size: 1.5rem; font-weight: bold; color: #667eea; }
        .stat .label { font-size: 0.8rem; color: #666; margin-top: 5px; }
        .section { padding: 15px; }
        .section h2 { font-size: 1rem; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .section h2 button { background: #667eea; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; }
        .product { background: white; border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; gap: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); overflow-x: auto; }
        .product img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; background: #eee; flex-shrink: 0; }
        .product .info { flex: 1; min-width: 0; }
        .product .name { font-weight: 600; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .product .meta { font-size: 0.85rem; color: #666; }
        .product .price { font-size: 1.1rem; font-weight: bold; color: #667eea; margin-top: 5px; }
        .product .actions { display: flex; flex-direction: column; gap: 5px; flex-shrink: 0; }
        .product .actions button { padding: 8px 12px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.85rem; }
        .btn-edit { background: #667eea; color: white; }
        .btn-delete { background: #ff6b6b; color: white; }
        .fab { position: fixed; bottom: 20px; right: 20px; width: 55px; height: 55px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; font-size: 1.8rem; cursor: pointer; box-shadow: 0 4px 15px rgba(102,126,234,0.4); display: flex; align-items: center; justify-content: center; z-index: 100; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 200; align-items: center; justify-content: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-box { background: white; border-radius: 20px; padding: 25px; width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto; }
        .modal-box h2 { font-size: 1.2rem; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-size: 0.9rem; color: #666; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 10px; font-size: 1rem; }
        .form-group input:focus { outline: none; border-color: #667eea; }
        .upload-box { border: 2px dashed #ddd; border-radius: 10px; padding: 25px; text-align: center; cursor: pointer; background: #f8f9fa; }
        .upload-box:hover { border-color: #667eea; }
        .preview { width: 100%; border-radius: 10px; margin-top: 10px; display: none; }
        .preview.show { display: block; }
        .btn-row { display: flex; gap: 10px; margin-top: 15px; }
        .btn-row button { flex: 1; padding: 14px; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-secondary { background: #eee; color: #666; }
        .empty { text-align: center; padding: 50px 20px; color: #999; }
        .empty .icon { font-size: 3rem; margin-bottom: 15px; }
        
        .cat-item { display: flex; align-items: center; gap: 10px; padding: 12px; background: #f8f9fa; border-radius: 10px; margin-bottom: 8px; }
        .cat-item .icon { font-size: 1.5rem; }
        .cat-item .name { flex: 1; font-weight: 500; }
        .cat-item .count { color: #667eea; font-size: 0.9rem; }
        .cat-item .actions { display: flex; gap: 5px; }
        .cat-item .actions button { padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.8rem; }
        
        /* åˆ†é¡ Modal */
        #cat-modal .modal-box { max-width: 350px; }
        
        /* ç¶²ç«™å…§å®¹ Modal */
        #site-modal .modal-box { max-width: 450px; }
    </style>
</head>
<body>
    <!-- ç™»å…¥é é¢ -->
    <div class="login-overlay" id="login-overlay">
        <div class="login-box">
            <div class="icon">ğŸŸ</div>
            <h1>Aquarium Studio</h1>
            <p>è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼</p>
            <form action="javascript:void(0)" onsubmit="checkLogin()">
                <input type="password" id="login-password" placeholder="å¯†ç¢¼" required>
                <button type="submit">ç™»å…¥</button>
            </form>
            <div class="error" id="login-error">å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡è©¦</div>
            <div class="hint">é è¨­å¯†ç¢¼ï¼š1234</div>
        </div>
    </div>

    <!-- ç®¡ç†å¾Œå° -->
    <div class="admin-content" id="admin-content">
        <div class="header">
            <h1>ğŸ›ï¸ å•†å“ç®¡ç†</h1>
            <div class="header-btns">
                <a href="index.html">ğŸ  é¦–é </a>
                <button onclick="editCategories()">ğŸ·ï¸ åˆ†é¡</button>
                <button onclick="editSiteContent()">ğŸ“ ç¶²ç«™</button>
                <button onclick="syncToGitHub()" id="sync-btn">ğŸ”„ åŒæ­¥</button>
                <button onclick="logout()" class="btn-logout">ğŸšª ç™»å‡º</button>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="num" id="count-products">0</div>
                <div class="label">å•†å“æ•¸</div>
            </div>
            <div class="stat">
                <div class="num" id="count-stock">0</div>
                <div class="label">ç¸½åº«å­˜</div>
            </div>
        </div>
        
        <div class="section">
            <h2>å•†å“åˆ—è¡¨ <button onclick="openModal()">â• æ–°å¢</button></h2>
            <div id="product-list">
                <div class="empty">
                    <div class="icon">ğŸ“¦</div>
                    <p>å°šæœªæœ‰å•†å“</p>
                </div>
            </div>
        </div>
        
        <button class="fab" onclick="openModal()">â•</button>
    </div>

    <!-- æ–°å¢/ç·¨è¼¯å•†å“ Modal -->
    <div class="modal" id="modal">
        <div class="modal-box">
            <h2 id="modal-title">æ–°å¢å•†å“</h2>
            <form onsubmit="saveProduct(event)">
                <input type="hidden" id="p-id">
                <div class="form-group">
                    <label>åç¨±</label>
                    <input type="text" id="p-name" required placeholder="å•†å“åç¨±">
                </div>
                <div class="form-group">
                    <label>åˆ†é¡</label>
                    <select id="p-cat"></select>
                </div>
                <div class="form-group">
                    <label>åƒ¹æ ¼</label>
                    <input type="number" id="p-price" required placeholder="0" min="0">
                </div>
                <div class="form-group">
                    <label>åº«å­˜</label>
                    <input type="number" id="p-stock" required placeholder="0" min="0">
                </div>
                <div class="form-group">
                    <label>åœ–ç‰‡ç¶²å€</label>
                    <input type="url" id="p-img" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>æè¿°</label>
                    <textarea id="p-desc" rows="3" placeholder="å•†å“æè¿°"></textarea>
                </div>
                <div class="btn-row">
                    <button type="button" class="btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn-primary">å„²å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- åˆ†é¡ç®¡ç† Modal -->
    <div class="modal" id="cat-modal">
        <div class="modal-box">
            <h2>ğŸ·ï¸ åˆ†é¡ç®¡ç†</h2>
            <div id="cat-list"></div>
            <form onsubmit="addCategory(event)" style="margin-top: 15px;">
                <div style="display: flex; gap: 10px;">
                    <select id="cat-new-icon" style="width: 60px;">
                        <option>ğŸŸ</option>
                        <option>âš™ï¸</option>
                        <option>ğŸ¦</option>
                        <option>ğŸ’§</option>
                        <option>ğŸŒ¿</option>
                        <option>ğŸ’Š</option>
                        <option>ğŸ”§</option>
                        <option>ğŸ¨</option>
                    </select>
                    <input type="text" id="cat-new-name" placeholder="æ–°åˆ†é¡åç¨±" style="flex: 1;" required>
                    <button type="submit" class="btn-primary" style="width: auto;">æ–°å¢</button>
                </div>
            </form>
            <button class="btn-secondary" onclick="closeCatModal()" style="width: 100%; margin-top: 15px;">é—œé–‰</button>
        </div>
    </div>

    <!-- ç¶²ç«™å…§å®¹ Modal -->
    <div class="modal" id="site-modal">
        <div class="modal-box">
            <h2>ğŸ“ ç¶²ç«™å…§å®¹</h2>
            <form onsubmit="saveSiteContent(event)">
                <div class="form-group">
                    <label>æ¨™é¡Œ</label>
                    <input type="text" id="site-title" placeholder="Aquarium Studio">
                </div>
                <div class="form-group">
                    <label>å‰¯æ¨™é¡Œ</label>
                    <input type="text" id="site-subtitle" placeholder="å°ˆæ¥­å­”é›€é­šé¤Šæ®–">
                </div>
                <div class="form-group">
                    <label>æè¿°</label>
                    <textarea id="site-desc" rows="3" placeholder="é—œæ–¼æˆ‘å€‘..."></textarea>
                </div>
                <div class="form-group">
                    <label>é›»è©±</label>
                    <input type="tel" id="site-phone" placeholder="0912-345-678">
                </div>
                <div class="form-group">
                    <label>åœ°å€</label>
                    <input type="text" id="site-address" placeholder="å°åŒ—å¸‚...">
                </div>
                <div class="btn-row">
                    <button type="button" class="btn-secondary" onclick="closeSiteModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn-primary">å„²å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <script>
    // å„²å­˜ key
    var STORAGE_KEYS = {
        products: 'aquarium_products',
        categories: 'aquarium_categories',
        login: 'aquarium_admin_logged'
    };
    
    // åˆå§‹åŒ–
    (function init() {
        // é è¨­åˆ†é¡
        if (!localStorage.getItem(STORAGE_KEYS.categories)) {
            localStorage.setItem(STORAGE_KEYS.categories, JSON.stringify([
                { id: '1', name: 'å­”é›€é­š', icon: 'ğŸŸ' },
                { id: '2', name: 'è¨­å‚™', icon: 'âš™ï¸' },
                { id: '3', name: 'é£¼æ–™', icon: 'ğŸ¦' },
                { id: '4', name: 'æ°´è³ª', icon: 'ğŸ’§' }
            ]));
        }
        
        // æª¢æŸ¥ç™»å…¥
        checkLogin();
    })();
    
    // ç™»å…¥æª¢æŸ¥
    function checkLogin() {
        var logged = localStorage.getItem(STORAGE_KEYS.login);
        if (logged === 'true') {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('admin-content').classList.add('active');
            render();
        }
    }
    
    // ç™»å…¥
    function checkLogin() {
        var pwd = document.getElementById('login-password').value;
        if (pwd === '1234') {
            localStorage.setItem(STORAGE_KEYS.login, 'true');
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('admin-content').classList.add('active');
            document.getElementById('login-password').value = '';
            document.getElementById('login-error').style.display = 'none';
            render();
        } else {
            document.getElementById('login-error').style.display = 'block';
        }
    }
    
    // ç™»å‡º
    function logout() {
        localStorage.removeItem(STORAGE_KEYS.login);
        location.reload();
    }
    
    // å–å¾—å•†å“
    function getProducts() {
        return JSON.parse(localStorage.getItem(STORAGE_KEYS.products) || '[]');
    }
    
    // å–å¾—åˆ†é¡
    function getCategories() {
        return JSON.parse(localStorage.getItem(STORAGE_KEYS.categories) || '[]');
    }
    
    // æ¸²æŸ“
    function render() {
        var products = getProducts();
        var cats = getCategories();
        
        document.getElementById('count-products').textContent = products.length;
        document.getElementById('count-stock').textContent = products.reduce(function(s, i) { return s + (i.stock || 0); }, 0);
        
        // æ¸²æŸ“åˆ†é¡ä¸‹æ‹‰é¸å–®
        var select = document.getElementById('p-cat');
        select.innerHTML = cats.map(function(c) { 
            return '<option value="' + c.name + '">' + c.icon + ' ' + c.name + '</option>'; 
        }).join('');
        
        // æ¸²æŸ“å•†å“åˆ—è¡¨
        var list = document.getElementById('product-list');
        if (products.length === 0) {
            list.innerHTML = '<div class="empty"><div class="icon">ğŸ“¦</div><p>å°šæœªæœ‰å•†å“</p></div>';
            return;
        }
        
        list.innerHTML = products.map(function(i) {
            return '<div class="product">' +
                '<img src="' + (i.image || 'images/products/default-guppy.svg') + '" onerror="this.src=\'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23eee%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2255%22 text-anchor=%22middle%22>ğŸŸ</text></svg>\">' +
                '<div class="info"><div class="name">' + i.name + '</div>' +
                '<div class="meta">' + i.category + ' â€¢ åº«å­˜: ' + i.stock + '</div>' +
                '<div class="price">$' + i.price + '</div></div>' +
                '<div class="actions"><button class="btn-edit" onclick="edit(' + i.id + ')">âœï¸</button>' +
                '<button class="btn-delete" onclick="del(' + i.id + ')">ğŸ—‘ï¸</button></div></div>';
        }).join('');
    }
    
    // é–‹å•Ÿ Modal
    function openModal() {
        document.getElementById('modal-title').textContent = 'æ–°å¢å•†å“';
        document.getElementById('p-id').value = '';
        document.getElementById('p-name').value = '';
        document.getElementById('p-price').value = '';
        document.getElementById('p-stock').value = '';
        document.getElementById('p-desc').value = '';
        document.getElementById('p-img').value = '';
        document.getElementById('preview-img').classList.remove('show');
        renderCategories();
        document.getElementById('modal').classList.add('active');
    }
    
    // ç·¨è¼¯
    function edit(id) {
        var p = getProducts().find(function(x) { return x.id == id; });
        if (!p) return;
        document.getElementById('modal-title').textContent = 'ç·¨è¼¯å•†å“';
        document.getElementById('p-id').value = p.id;
        document.getElementById('p-name').value = p.name;
        document.getElementById('p-price').value = p.price;
        document.getElementById('p-stock').value = p.stock;
        document.getElementById('p-desc').value = p.description || '';
        document.getElementById('p-img').value = p.image || '';
        renderCategories();
        setTimeout(function() { document.getElementById('p-cat').value = p.category; }, 0);
        if (p.image) {
            document.getElementById('preview-img').src = p.image;
            document.getElementById('preview-img').classList.add('show');
        }
        document.getElementById('modal').classList.add('active');
    }
    
    // åˆªé™¤
    function del(id) {
        if (!confirm('åˆªé™¤é€™å€‹å•†å“ï¼Ÿ')) return;
        var products = getProducts().filter(function(x) { return x.id != id; });
        localStorage.setItem(STORAGE_KEYS.products, JSON.stringify(products));
        render();
    }
    
    // é—œé–‰ Modal
    function closeModal() {
        document.getElementById('modal').classList.remove('active');
    }
    
    // æ¸²æŸ“åˆ†é¡
    function renderCategories() {
        var select = document.getElementById('p-cat');
        select.innerHTML = getCategories().map(function(c) { 
            return '<option value="' + c.name + '">' + c.icon + ' ' + c.name + '</option>'; 
        }).join('');
    }
    
    // åˆ†é¡ç®¡ç†
    function editCategories() {
        var cats = getCategories();
        var products = getProducts();
        document.getElementById('cat-list').innerHTML = cats.map(function(c) {
            var count = products.filter(function(p) { return p.category === c.name; }).length;
            return '<div class="cat-item"><span class="icon">' + c.icon + '</span>' +
                '<span class="name">' + c.name + '</span>' +
                '<span class="count">' + count + ' é …</span>' +
                '<div class="actions"><button class="btn-secondary" onclick="editCat(\'' + c.id + '\')">âœï¸</button>' +
                '<button class="btn-delete" onclick="delCat(\'' + c.id + '\')" ' + (count > 0 ? 'disabled' : '') + '>ğŸ—‘ï¸</button></div></div>';
        }).join('') || '<p style="text-align:center;color:#999;">å°šç„¡åˆ†é¡</p>';
        document.getElementById('cat-modal').classList.add('active');
    }
    
    function editCat(id) {
        var cat = getCategories().find(function(c) { return c.id == id; });
        if (!cat) return;
        var newName = prompt('è¼¸å…¥æ–°åç¨±ï¼š', cat.name);
        if (newName && newName.trim()) {
            var cats = getCategories().map(function(c) { 
                return c.id == id ? {id: c.id, name: newName.trim(), icon: c.icon} : c; 
            });
            localStorage.setItem(STORAGE_KEYS.categories, JSON.stringify(cats));
            editCategories();
        }
    }
    
    function delCat(id) {
        var cat = getCategories().find(function(c) { return c.id == id; });
        if (!cat) return;
        if (!confirm('åˆªé™¤åˆ†é¡ã€Œ' + cat.name + 'ã€ï¼Ÿ')) return;
        var cats = getCategories().filter(function(c) { return c.id != id; });
        localStorage.setItem(STORAGE_KEYS.categories, JSON.stringify(cats));
        editCategories();
    }
    
    function addCategory(e) {
        e.preventDefault();
        var name = document.getElementById('cat-new-name').value.trim();
        var icon = document.getElementById('cat-new-icon').value;
        if (!name) return;
        var cats = getCategories();
        cats.push({ id: Date.now().toString(), name: name, icon: icon });
        localStorage.setItem(STORAGE_KEYS.categories, JSON.stringify(cats));
        document.getElementById('cat-new-name').value = '';
        editCategories();
    }
    
    function closeCatModal() {
        document.getElementById('cat-modal').classList.remove('active');
    }
    
    // ç¶²ç«™å…§å®¹
    function editSiteContent() {
        var c = JSON.parse(localStorage.getItem('site_content') || '{}');
        document.getElementById('site-title').value = c.title || '';
        document.getElementById('site-subtitle').value = c.subtitle || '';
        document.getElementById('site-desc').value = c.description || '';
        document.getElementById('site-phone').value = c.phone || '';
        document.getElementById('site-address').value = c.address || '';
        document.getElementById('site-modal').classList.add('active');
    }
    
    function saveSiteContent(e) {
        e.preventDefault();
        var c = {
            title: document.getElementById('site-title').value,
            subtitle: document.getElementById('site-subtitle').value,
            description: document.getElementById('site-desc').value,
            phone: document.getElementById('site-phone').value,
            address: document.getElementById('site-address').value,
            updated_at: new Date().toISOString()
        };
        localStorage.setItem('site_content', JSON.stringify(c));
        document.getElementById('site-modal').classList.remove('active');
        alert('å·²æ›´æ–°ï¼');
    }
    
    function closeSiteModal() {
        document.getElementById('site-modal').classList.remove('active');
    }
    
    // å„²å­˜å•†å“
    function saveProduct(e) {
        e.preventDefault();
        var id = document.getElementById('p-id').value;
        var product = {
            id: id ? parseInt(id) : Date.now(),
            name: document.getElementById('p-name').value,
            price: parseInt(document.getElementById('p-price').value),
            stock: parseInt(document.getElementById('p-stock').value),
            category: document.getElementById('p-cat').value,
            description: document.getElementById('p-desc').value,
            updated_at: new Date().toISOString()
        };
        
        var img = document.getElementById('p-img').value;
        var products = getProducts();
        var oldImg = products.find(function(x) { return x.id == id; })?.image;
        product.image = img || oldImg || 'images/products/default-guppy.svg';
        
        var index = products.findIndex(function(x) { return x.id == id; });
        if (index >= 0) { products[index] = product; }
        else { products.push(product); }
        
        localStorage.setItem(STORAGE_KEYS.products, JSON.stringify(products));
        closeModal();
        render();
        alert(id ? 'å·²æ›´æ–°ï¼' : 'å·²æ–°å¢ï¼');
    }
    
    // åŒæ­¥åˆ° GitHub
    async function syncToGitHub() {
        var btn = document.getElementById('sync-btn');
        btn.disabled = true;
        btn.textContent = 'åŒæ­¥ä¸­...';
        
        try {
            var products = getProducts();
            var categories = getCategories();
            var repo = 'yasonok/AquariumStudio_Project';
            var token = typeof GITHUB_TOKEN !== 'undefined' ? GITHUB_TOKEN : '';
            
            if (!token) {
                alert('éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° GitHub Token');
                throw new Error('No token');
            }
            
            // æ›´æ–° products.json
            var productsResp = await fetch('https://api.github.com/repos/' + repo + '/contents/products.json', {
                headers: { Authorization: 'token ' + token }
            });
            var productsData = await productsResp.json();
            
            await fetch('https://api.github.com/repos/' + repo + '/contents/products.json', {
                method: 'PUT',
                headers: { Authorization: 'token ' + token, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    message: 'æ›´æ–°å•†å“ï¼š' + products.length + 'é …',
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(products, null, 2))),
                    sha: productsData.sha
                })
            });
            
            // æ›´æ–° categories.json
            var catsResp = await fetch('https://api.github.com/repos/' + repo + '/contents/categories.json', {
                headers: { Authorization: 'token ' + token }
            });
            var catsData = await catsResp.json();
            
            await fetch('https://api.github.com/repos/' + repo + '/contents/categories.json', {
                method: 'PUT',
                headers: { Authorization: 'token ' + token, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    message: 'æ›´æ–°åˆ†é¡ï¼š' + categories.length + 'å€‹',
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(categories, null, 2))),
                    sha: catsData.sha
                })
            });
            
            btn.textContent = 'âœ… å·²åŒæ­¥ï¼';
            setTimeout(function() { btn.textContent = 'ğŸ”„ åŒæ­¥'; }, 3000);
            alert('å·²åŒæ­¥åˆ° GitHubï¼\nVercel å°‡è‡ªå‹•éƒ¨ç½²ï¼Œå¹¾åˆ†é˜å¾Œå®¢æˆ¶çœ‹åˆ°æ›´æ–°ï¼');
            
        } catch (error) {
            btn.disabled = false;
            btn.textContent = 'ğŸ”„ åŒæ­¥';
            alert('åŒæ­¥å¤±æ•—ï¼š' + error.message);
        }
    }
    
    // Modal é»æ“Šé—œé–‰
    document.getElementById('modal').addEventListener('click', function(e) {
        if (e.target === document.getElementById('modal')) closeModal();
    });
    </script>
</body>
</html>
