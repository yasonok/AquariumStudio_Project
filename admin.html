<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“ç®¡ç† - Aquarium Studio</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: #f5f5f5; min-height: 100vh; }
        
        /* ç™»å…¥é é¢ */
        .login-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea, #764ba2); z-index: 9999; align-items: center; justify-content: center; padding: 20px; }
        .login-overlay.active { display: flex; }
        .login-box { background: white; border-radius: 20px; padding: 40px 30px; width: 100%; max-width: 360px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.2); }
        .login-box .icon { font-size: 3.5rem; margin-bottom: 15px; }
        .login-box h1 { font-size: 1.4rem; margin-bottom: 8px; color: #333; }
        .login-box p { color: #888; font-size: 0.9rem; margin-bottom: 25px; }
        .login-box input { width: 100%; padding: 16px; border: 2px solid #eee; border-radius: 12px; font-size: 1.1rem; text-align: center; margin-bottom: 15px; transition: all 0.3s; }
        .login-box input:focus { outline: none; border-color: #667eea; }
        .login-box button { width: 100%; padding: 16px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .login-box button:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102,126,234,0.4); }
        .login-box .error { color: #ff6b6b; font-size: 0.85rem; margin-top: 10px; display: none; }
        .login-box .hint { color: #888; font-size: 0.8rem; margin-top: 15px; }
        
        /* Firebase ç‹€æ…‹ */
        .fb-status { background: #fff3cd; color: #856404; padding: 10px 15px; border-radius: 8px; margin-bottom: 15px; font-size: 0.85rem; display: none; }
        .fb-status.show { display: block; }
        
        /* ç®¡ç†å¾Œå° */
        .admin-content { display: none; }
        .admin-content.active { display: block; }
        
        .header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .header h1 { font-size: 1.2rem; }
        .header-btns { display: flex; gap: 8px; align-items: center; }
        .header-btns button, .header-btns a { background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; text-decoration: none; }
        .header-btns button:hover { background: rgba(255,255,255,0.3); }
        .header-btns .user-info { background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 8px; font-size: 0.85rem; }
        .header-btns .btn-logout { background: rgba(255,107,107,0.8); }
        
        .stats { display: flex; gap: 10px; padding: 15px; background: white; overflow-x: auto; }
        .stat { min-width: 100px; text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px; flex: 1; }
        .stat .num { font-size: 1.5rem; font-weight: bold; color: #667eea; }
        .stat .label { font-size: 0.8rem; color: #666; margin-top: 5px; }
        .section { padding: 15px; }
        .section h2 { font-size: 1rem; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .section h2 button { background: #667eea; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; }
        .product { background: white; border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; gap: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); overflow-x: auto; }
        .product img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; background: #eee; flex-shrink: 0; }
        .product .info { flex: 1; min-width: 0; }
        .product .name { font-weight: 600; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .product .meta { font-size: 0.85rem; color: #666; }
        .product .price { font-size: 1.1rem; font-weight: bold; color: #667eea; margin-top: 5px; }
        .product .actions { display: flex; flex-direction: column; gap: 5px; flex-shrink: 0; }
        .product .actions button { padding: 8px 12px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.85rem; }
        .btn-edit { background: #667eea; color: white; }
        .btn-delete { background: #ff6b6b; color: white; }
        .fab { position: fixed; bottom: 20px; right: 20px; width: 55px; height: 55px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; font-size: 1.8rem; cursor: pointer; box-shadow: 0 4px 15px rgba(102,126,234,0.4); display: flex; align-items: center; justify-content: center; z-index: 100; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 100; align-items: center; justify-content: center; padding: 15px; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 16px; width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 1rem; }
        .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666; }
        .modal-body { padding: 15px; }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 5px; font-size: 0.9rem; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 10px; font-size: 1rem; }
        .form-group input:focus { outline: none; border-color: #667eea; }
        .upload-box { border: 2px dashed #ddd; border-radius: 10px; padding: 25px; text-align: center; cursor: pointer; background: #f8f9fa; }
        .upload-box:hover { border-color: #667eea; }
        .preview { width: 100%; border-radius: 10px; margin-top: 10px; display: none; }
        .preview.show { display: block; }
        .btn-row { display: flex; gap: 10px; margin-top: 15px; }
        .btn-row button { flex: 1; padding: 14px; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-secondary { background: #eee; color: #666; }
        .empty { text-align: center; padding: 50px 20px; color: #999; }
        .empty .icon { font-size: 3rem; margin-bottom: 15px; }
        
        .cat-item { display: flex; align-items: center; gap: 10px; padding: 12px; background: #f8f9fa; border-radius: 10px; margin-bottom: 8px; }
        .cat-item .icon { font-size: 1.5rem; }
        .cat-item .name { flex: 1; font-weight: 500; }
        .cat-item .count { color: #667eea; font-size: 0.9rem; }
        .cat-item .actions { display: flex; gap: 5px; }
        .cat-item .actions button { padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.8rem; }
    </style>
</head>
<body>
    <!-- ç™»å…¥é é¢ -->
    <div class="login-overlay active" id="login-overlay">
        <div class="login-box">
            <div class="icon">ğŸŸ</div>
            <h1>Aquarium Studio</h1>
            <p>è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼</p>
            <input type="password" id="login-password" placeholder="å¯†ç¢¼" onkeyup="if(event.key==='Enter')login()">
            <button onclick="login()">ç™»å…¥</button>
            <div class="error" id="login-error">å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡è©¦</div>
            <div class="hint">é è¨­å¯†ç¢¼ï¼š1234</div>
        </div>
    </div>

    <!-- Firebase ç‹€æ…‹ -->
    <div class="fb-status" id="fb-status"></div>

    <!-- ç®¡ç†å¾Œå° -->
    <div class="admin-content" id="admin-content">
        <div class="header">
            <h1>ğŸ›ï¸ å•†å“ç®¡ç†</h1>
            <div class="header-btns">
                <a href="index.html">ğŸ  é¦–é </a>
                <button onclick="editCategories()">ğŸ·ï¸ åˆ†é¡</button>
                <button onclick="editSiteContent()">ğŸ“ ç¶²ç«™</button>
                <span class="user-info" id="sync-status">ğŸ“¤ æœªåŒæ­¥</span>
                <button class="btn-logout" onclick="syncToGitHub()" id="sync-btn">ğŸ”„ åŒæ­¥</button>
                <button class="btn-logout" onclick="logout()">ğŸšª ç™»å‡º</button>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="num" id="count-products">0</div>
                <div class="label">å•†å“æ•¸</div>
            </div>
            <div class="stat">
                <div class="num" id="count-stock">0</div>
                <div class="label">ç¸½åº«å­˜</div>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“¦ å•†å“åˆ—è¡¨ <button onclick="openModal()">â• æ–°å¢</button></h2>
            <div id="product-list">
                <div class="empty"><div class="icon">ğŸ“¦</div><p>è¼‰å…¥ä¸­...</p></div>
            </div>
        </div>
        
        <button class="fab" onclick="openModal()">+</button>
    </div>
    
    <!-- å•†å“ Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">æ–°å¢å•†å“</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <img id="preview-img" class="preview" alt="é è¦½">
                <div class="upload-box" onclick="document.getElementById('img-input').click()">
                    <div class="icon">ğŸ“·</div>
                    <p>é»æ“Šé¸æ“‡åœ–ç‰‡</p>
                </div>
                <input type="file" id="img-input" accept="image/*" style="display:none" onchange="handleImg(this)">
                
                <form onsubmit="save(event)">
                    <input type="hidden" id="p-id">
                    <input type="hidden" id="p-img">
                    
                    <div class="form-group">
                        <label>ğŸŸ åç¨± *</label>
                        <input type="text" id="p-name" required placeholder="ä¾‹å¦‚ï¼šç´…è‰²å­”é›€é­š">
                    </div>
                    
                    <div class="form-group">
                        <label>ğŸ’° åƒ¹æ ¼ *</label>
                        <input type="number" id="p-price" required placeholder="200" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>ğŸ“¦ åº«å­˜ *</label>
                        <input type="number" id="p-stock" required placeholder="10" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>ğŸ·ï¸ åˆ†é¡ *</label>
                        <select id="p-cat" required></select>
                    </div>
                    
                    <div class="form-group">
                        <label>ğŸ“ æè¿°</label>
                        <textarea id="p-desc" rows="2" placeholder="å•†å“ç‰¹è‰²"></textarea>
                    </div>
                    
                    <div class="btn-row">
                        <button type="submit" class="btn-primary">ğŸ’¾ å„²å­˜</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- åˆ†é¡ Modal -->
    <div class="modal" id="cat-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ·ï¸ åˆ†é¡ç®¡ç†</h3>
                <button class="modal-close" onclick="closeCatModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="cat-list"></div>
                
                <div style="margin-top:20px; padding-top:15px; border-top:1px solid #eee;">
                    <h4 style="margin-bottom:15px; font-size:0.95rem;">â• æ–°å¢åˆ†é¡</h4>
                    <form onsubmit="addCategory(event)">
                        <div class="form-group">
                            <label>ğŸ·ï¸ åç¨± *</label>
                            <input type="text" id="cat-new-name" required placeholder="ä¾‹å¦‚ï¼šé€²å£é­š">
                        </div>
                        <div class="form-group">
                            <label>ğŸŒˆ åœ–ç¤º</label>
                            <select id="cat-new-icon">
                                <option value="ğŸŸ">ğŸŸ é­š</option>
                                <option value="ğŸ ">ğŸ  ç†±å¸¶é­š</option>
                                <option value="ğŸ¦">ğŸ¦ è¦</option>
                                <option value="ğŸš">ğŸš è²é¡</option>
                                <option value="âš™ï¸">âš™ï¸ è¨­å‚™</option>
                                <option value="ğŸ’§">ğŸ’§ æ°´è³ª</option>
                                <option value="ğŸŒ¿">ğŸŒ¿ æ°´è‰</option>
                                <option value="ğŸ“¦">ğŸ“¦ å…¶ä»–</option>
                            </select>
                        </div>
                        <button type="submit" class="btn-primary" style="width:100%;">â• æ–°å¢</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç¶²ç«™å…§å®¹ Modal -->
    <div class="modal" id="site-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“ ç¶²ç«™å…§å®¹</h3>
                <button class="modal-close" onclick="closeSiteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form onsubmit="saveSiteContent(event)">
                    <div class="form-group">
                        <label>ğŸ  å•†åº—åç¨±</label>
                        <input type="text" id="site-title" placeholder="ä¾‹å¦‚ï¼šç‘å®‰æ°´æ—">
                    </div>
                    
                    <div class="form-group">
                        <label>ğŸ“¢ å‰¯æ¨™é¡Œ</label>
                        <input type="text" id="site-subtitle" placeholder="å°ˆæ¥­å­”é›€é­šå°ˆè³£åº—">
                    </div>
                    
                    <div class="form-group">
                        <label>ğŸ“ å•†åº—æè¿°</label>
                        <textarea id="site-desc" rows="3" placeholder="ä»‹ç´¹ä½ çš„å•†åº—..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>ğŸ“ è¯çµ¡é›»è©±</label>
                        <input type="text" id="site-phone" placeholder="09xx-xxx-xxx">
                    </div>
                    
                    <div class="form-group">
                        <label>ğŸ“ åœ°å€</label>
                        <input type="text" id="site-address" placeholder="ç¸£å¸‚é„‰é®...">
                    </div>
                    
                    <div class="btn-row">
                        <button type="button" class="btn-secondary" onclick="closeSiteModal()">å–æ¶ˆ</button>
                        <button type="submit" class="btn-primary">ğŸ’¾ å„²å­˜</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>const USE_FIREBASE = false;</script>
    
    <script>
        const LOGIN_KEY = 'aquarium_admin_logged';
        const DEFAULT_PASSWORD = '1234';
        const SITE_KEY = 'site_content';
        
        // ç™»å…¥ç‹€æ…‹æª¢æŸ¥
        function checkLogin() {
            if (localStorage.getItem(LOGIN_KEY) === 'true') {
                document.getElementById('login-overlay').classList.remove('active');
                document.getElementById('admin-content').classList.add('active');
                render();
            } else {
                document.getElementById('login-overlay').classList.add('active');
                document.getElementById('admin-content').classList.remove('active');
            }
        }
        
        // ç™»å…¥
        function login() {
            const pwd = document.getElementById('login-password').value;
            if (pwd === DEFAULT_PASSWORD) {
                localStorage.setItem(LOGIN_KEY, 'true');
                document.getElementById('login-overlay').classList.remove('active');
                document.getElementById('admin-content').classList.add('active');
                document.getElementById('login-password').value = '';
                document.getElementById('login-error').style.display = 'none';
                render();
            } else {
                document.getElementById('login-error').style.display = 'block';
            }
        }
        
        // ç™»å‡º
        function logout() {
            localStorage.removeItem(LOGIN_KEY);
            document.getElementById('login-overlay').classList.add('active');
            document.getElementById('admin-content').classList.remove('active');
        }
        
        // è¼‰å…¥åˆ†é¡
        async function renderCategories() {
            const cats = getCategories();
            const select = document.getElementById('p-cat');
            select.innerHTML = cats.map(c => `<option value="${c.name}">${c.icon} ${c.name}</option>`).join('');
        }
        
        // æ¸²æŸ“å•†å“åˆ—è¡¨
        async function render() {
            try {
                const products = getProducts();
                const cats = getCategories();
                
                document.getElementById('count-products').textContent = products.length;
                document.getElementById('count-stock').textContent = products.reduce((s, i) => s + (i.stock||0), 0);
                
                await renderCategories();
                
                const list = document.getElementById('product-list');
                if (products.length === 0) {
                    list.innerHTML = '<div class="empty"><div class="icon">ğŸ“¦</div><p>å°šæœªæœ‰å•†å“</p></div>';
                    return;
                }
                
                list.innerHTML = products.map(i => `
                    <div class="product">
                        <img src="${i.image || 'images/products/default-guppy.svg'}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23eee%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2255%22 text-anchor=%22middle%22>ğŸŸ</text></svg>'">
                        <div class="info">
                            <div class="name">${i.name}</div>
                            <div class="meta">${i.category} â€¢ åº«å­˜: ${i.stock}</div>
                            <div class="price">$${i.price}</div>
                        </div>
                        <div class="actions">
                            <button class="btn-edit" onclick="edit(${i.id})">âœï¸</button>
                            <button class="btn-delete" onclick="del(${i.id})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Render error:', error);
            }
        }
        
        // é–‹å•Ÿæ–°å¢ Modal
        function openModal() {
            document.getElementById('modal-title').textContent = 'æ–°å¢å•†å“';
            document.getElementById('p-id').value = '';
            document.getElementById('p-name').value = '';
            document.getElementById('p-price').value = '';
            document.getElementById('p-stock').value = '';
            document.getElementById('p-desc').value = '';
            document.getElementById('p-img').value = '';
            document.getElementById('preview-img').classList.remove('show');
            renderCategories();
            document.getElementById('modal').classList.add('active');
        }
        
        // ç·¨è¼¯å•†å“
        async function edit(id) {
            const products = getProducts();
            const p = products.find(x => x.id == id || x.id === id);
            if (!p) return;
            
            document.getElementById('modal-title').textContent = 'ç·¨è¼¯å•†å“';
            document.getElementById('p-id').value = p.id;
            document.getElementById('p-name').value = p.name;
            document.getElementById('p-price').value = p.price;
            document.getElementById('p-stock').value = p.stock;
            document.getElementById('p-desc').value = p.description || '';
            document.getElementById('p-img').value = p.image || '';
            
            await renderCategories();
            setTimeout(() => document.getElementById('p-cat').value = p.category, 0);
            
            if (p.image) {
                document.getElementById('preview-img').src = p.image;
                document.getElementById('preview-img').classList.add('show');
            }
            document.getElementById('modal').classList.add('active');
        }
        
        // åˆªé™¤å•†å“
        async function del(id) {
            if (!confirm('åˆªé™¤é€™å€‹å•†å“ï¼Ÿ')) return;
            del(id);
            render();
        }
        
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }
        
        // åˆ†é¡ç®¡ç†
        async function editCategories() {
            const cats = getCategories();
            const products = getProducts();
            
            document.getElementById('cat-list').innerHTML = cats.map(c => {
                const count = products.filter(p => p.category === c.name).length;
                return `
                    <div class="cat-item">
                        <span class="icon">${c.icon}</span>
                        <span class="name">${c.name}</span>
                        <span class="count">${count} é …</span>
                        <div class="actions">
                            <button class="btn-secondary" onclick="editCat('${c.id}')">âœï¸</button>
                            <button class="btn-delete" onclick="delCat('${c.id}')" ${count > 0 ? 'disabled' : ''}>ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
            }).join('') || '<p style="text-align:center;color:#999;">å°šç„¡åˆ†é¡</p>';
            
            document.getElementById('cat-modal').classList.add('active');
        }
        
        async function editCat(id) {
            const cats = getCategories();
            const cat = cats.find(c => c.id == id || c.id === id);
            if (!cat) return;
            
            const newName = prompt('è¼¸å…¥æ–°åç¨±ï¼š', cat.name);
            if (newName && newName.trim()) {
                cat.name = newName.trim();
                saveCategory(cat);
                editCategories();
            }
        }
        
        async function delCat(id) {
            const cats = getCategories();
            const cat = cats.find(c => c.id == id || c.id === id);
            if (!cat) return;
            
            if (!confirm(`åˆªé™¤åˆ†é¡ã€Œ${cat.nameã€ï¼Ÿ`)) return;
            deleteCategory(id);
            editCategories();
        }
        
        async function addCategory(e) {
            e.preventDefault();
            const name = document.getElementById('cat-new-name').value.trim();
            const icon = document.getElementById('cat-new-icon').value;
            if (!name) return;
            
            const cats = getCategories();
            cats.push({ id: Date.now().toString(), name, icon });
            await getCategories().filter(x => x.id != cat.id) ? (localStorage.setItem('aquarium_categories', JSON.stringify(getCategories().filter(x => x.id != cat.id)), true) : localStorage.setItem('aquarium_categories', JSON.stringify(cats));
            
            document.getElementById('cat-new-name').value = '';
            editCategories();
        }
        
        function closeCatModal() {
            document.getElementById('cat-modal').classList.remove('active');
        }
        
        // åœ–ç‰‡è™•ç†
        function handleImg(input) {
            if (!input.files[0]) return;
            const file = input.files[0];
            const r = new FileReader();
            r.onload = e => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 600;
                    canvas.height = 600;
                    const ctx = canvas.getContext('2d');
                    
                    let sx = 0, sy = 0, sw = img.width, sh = img.height;
                    if (sw > sh) {
                        sx = (sw - sh) / 2;
                        sw = sh;
                    } else {
                        sy = (sh - sw) / 2;
                        sh = sw;
                    }
                    
                    ctx.drawImage(img, sx, sy, sw, sh, 0, 0, 600, 600);
                    const result = canvas.toDataURL('image/jpeg', 0.85);
                    
                    document.getElementById('preview-img').src = result;
                    document.getElementById('preview-img').classList.add('show');
                    document.getElementById('p-img').value = result;
                };
                img.src = e.target.result;
            };
            r.readAsDataURL(file);
        }
        
        // ç¶²ç«™å…§å®¹
        function editSiteContent() {
            const c = JSON.parse(localStorage.getItem(SITE_KEY) || '{}');
            document.getElementById('site-title').value = c.title || '';
            document.getElementById('site-subtitle').value = c.subtitle || '';
            document.getElementById('site-desc').value = c.description || '';
            document.getElementById('site-phone').value = c.phone || '';
            document.getElementById('site-address').value = c.address || '';
            document.getElementById('site-modal').classList.add('active');
        }
        
        function saveSiteContent(e) {
            e.preventDefault();
            const c = {
                title: document.getElementById('site-title').value,
                subtitle: document.getElementById('site-subtitle').value,
                description: document.getElementById('site-desc').value,
                phone: document.getElementById('site-phone').value,
                address: document.getElementById('site-address').value,
                updated_at: new Date().toISOString()
            };
            localStorage.setItem(SITE_KEY, JSON.stringify(c));
            document.getElementById('site-modal').classList.remove('alert('âœ… ç¶²ç«™å…§å®¹å·²æ›´æ–°ï¼');
        }
        
        function closeSiteModal() {
            document.getElementById('site-modal').classList.remove('active');
        }
        
        // å„²å­˜å•†å“
        async function save(e) {
            e.preventDefault();
            
            const id = document.getElementById('p-id').value;
            const product = {
                id: id ? parseInt(id) : Date.now(),
                name: document.getElementById('p-name').value,
                price: parseInt(document.getElementById('p-price').value),
                stock: parseInt(document.getElementById('p-stock').value),
                category: document.getElementById('p-cat').value,
                description: document.getElementById('p-desc').value,
                updated_at: new Date().toISOString()
            };
            
            const img = document.getElementById('p-img').value;
            const products = getProducts();
            const oldImg = products.find(x => x.id == id || x.id === id)?.image;
            product.image = img || oldImg || 'images/products/default-guppy.svg';
            
            saveProductToStorage(product);
            
            closeModal();
            render();
            alert(id ? 'âœ… å·²æ›´æ–°ï¼' : 'âœ… å·²æ–°å¢ï¼');
        }
        
        // é¡å¤–å‡½æ•¸
        function saveProductToStorage(p) {
            const products = getProducts();
            const idx = products.findIndex(x => x.id == p.id);
            if (idx >= 0) { products[idx] = p; } else { products.push(p); }
            localStorage.setItem('aquarium_products', JSON.stringify(products));
        }
        
        function saveCategory(c) {
            const cats = getCategories();
            const idx = cats.findIndex(x => x.id == c.id);
            if (idx >= 0) { cats[idx] = c; } else { cats.push(c); }
            localStorage.setItem('aquarium_categories', JSON.stringify(cats));
        }
        
        function deleteCategory(id) {
            const cats = getCategories().filter(x => x.id != id);
            localStorage.setItem('aquarium_categories', JSON.stringify(cats));
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', checkLogin);
        document.getElementById('modal').addEventListener('click', e => { if (e.target === document.getElementById('modal')) closeModal(); });
    </script>
</body>
</html>
        // åŒæ­¥åˆ° GitHub
        async function syncToGitHub() {
            const btn = document.getElementById("sync-btn");
            const status = document.getElementById("sync-status");
            
            btn.disabled = true;
            btn.textContent = "ğŸ”„ åŒæ­¥ä¸­...";
            
            try {
                const products = JSON.parse(localStorage.getItem("aquarium_products") || "[]");
                const categories = JSON.parse(localStorage.getItem("aquarium_categories") || "[]");
                
                const repo = "yasonok/AquariumStudio_Project";
                const token = typeof GITHUB_TOKEN !== "undefined" ? GITHUB_TOKEN : "";
                
                // æ›´æ–° products.json
                const productsResp = await fetch("https://api.github.com/repos/" + repo + "/contents/products.json", {
                    headers: { Authorization: "token " + token }
                });
                const productsData = await productsResp.json();
                
                await fetch("https://api.github.com/repos/" + repo + "/contents/products.json", {
                    method: "PUT",
                    headers: { Authorization: "token " + token, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        message: "æ›´æ–°å•†å“ï¼š" + products.length + "é …",
                        content: btoa(unescape(encodeURIComponent(JSON.stringify(products, null, 2))),
                        sha: productsData.sha
                    })
                });
                
                // æ›´æ–° categories.json
                const catsResp = await fetch("https://api.github.com/repos/" + repo + "/contents/categories.json", {
                    headers: { Authorization: "token " + token }
                });
                const catsData = await catsResp.json();
                
                await fetch("https://api.github.com/repos/" + repo + "/contents/categories.json", {
                    method: "PUT",
                    headers: { Authorization: "token " + token, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        message: "æ›´æ–°åˆ†é¡ï¼š" + categories.length + "å€‹",
                        content: btoa(unescape(encodeURIComponent(JSON.stringify(categories, null, 2))),
                        sha: catsData.sha
                    })
                });
                
                btn.textContent = "âœ… å·²åŒæ­¥ï¼";
                status.textContent = "âœ… å·²åŒæ­¥";
                
                setTimeout(function() {
                    btn.textContent = "ğŸ”„ åŒæ­¥";
                    status.textContent = "ğŸ“¤ æœªåŒæ­¥";
                }, 3000);
                
                alert("âœ… å·²åŒæ­¥åˆ° GitHubï¼\nVercel å°‡è‡ªå‹•éƒ¨ç½²ï¼Œå¹¾åˆ†é˜å¾Œå®¢æˆ¶çœ‹åˆ°æ›´æ–°ï¼");
                
            } catch (error) {
                console.error(error);
                btn.disabled = false;
                btn.textContent = "ğŸ”„ åŒæ­¥";
                alert("âŒ åŒæ­¥å¤±æ•—ï¼š" + error.message);
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', checkLogin);
        document.getElementById('modal').addEventListener('click', e => { if (e.target === document.getElementById('modal')) closeModal(); });
    </script>
</body>
</html>
